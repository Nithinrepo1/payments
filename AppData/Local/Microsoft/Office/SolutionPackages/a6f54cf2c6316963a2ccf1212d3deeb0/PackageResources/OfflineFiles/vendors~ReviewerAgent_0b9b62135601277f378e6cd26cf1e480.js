"use strict";(self.webpackChunkTypeScriptModule=self.webpackChunkTypeScriptModule||[]).push([[7410],{83206:(e,t,i)=>{i.r(t),i.d(t,{ReviewerAgent:()=>Ye,ReviewerAgentLaunchType:()=>z});var n=i(89125),s=i(22829),a=i(34377),o=i(8520),r=i(73267),g=i(93176),d=i(70825),l=i(32060),c=i(62096),u=i(24643),h=i(93031),p=i(74113),m=i(87396),C=i(80607),R=i(72813),S=i(27708),v=i(1335),f=i(978),I=i(50904),y=i(30112),w=i(80617),T=i(87144),A=i(16895),E=i(658);const D={color:w.L.colorNeutralForeground4,alignItems:"flex-start",...T.g.body1,fontStyle:"normal",...A.Pt.gap("1px"),content:"attr(title)"},P={color:w.L.colorNeutralForegroundDisabled,"@media (forced-colors: active)":{forcedColorAdjust:"none"}},L={...T.g.body1,alignItems:"flex-start",fontStyle:"normal",...A.Pt.gap("1px"),whiteSpace:"pre-wrap",display:"inline-block",width:"100%","&:focus":{...A.Pt.outline(0)}},N={userInput:{...L,"&:focus":{...A.Pt.outline(0)},"&:focus::after":D,"&::after":D}},M={userInput:{...L,"&:focus":{...A.Pt.outline(0)}}},U={userInput:{"&:focus::after":P,"&::after":P}},b=((0,E.n)(M),(0,E.n)(N)),k=(0,E.n)(U),_="";var F=i(58651);const O=e=>{const{isDisabled:t=!1,placeholderText:i=_,editorProps:n,onItemSelected:s,overrideStyles:a,startInMenuOpenState:r,queryCharToUse:g}=e,d=g??f.O8,l=o.useRef(),c=(0,o.useRef)(!0),[u,h]=o.useState(void 0),p=(0,o.useRef)(null),[m,C]=(0,o.useState)(void 0),[R,S]=(0,o.useState)(i),v=o.useCallback((()=>{if(!t&&n?.handleInChatInput&&n?.editorConfig&&!l.current&&n?.alSession){if(!c.current)return n?.editorConfig?.telemLogger?.logSuccessTelemetry("Editor_Bootstrap_Skipped","ShouldBootStrapEditor is false"),void F.log("EditorBootstrapping is skipped as shouldBootStrapEditor is false");const t=(new I.V).createInstance();c.current=!1,t.bootstrap((e=n.editorConfig,i=n.alSession,{...e,augloopSession:i})).then((e=>{l.current=t,h(e)}))}var e,i}),[n?.alSession,n?.handleInChatInput,n?.editorConfig,t]);(0,o.useEffect)((()=>{v()}),[v]),(0,o.useEffect)((()=>()=>{l.current&&(l.current.shutdown(),l.current=void 0,h(void 0),C(void 0),c.current=!0)}),[n?.alSession,n?.handleInChatInput,n?.editorConfig]),(0,o.useEffect)((()=>{if(n?.handleInChatInput&&n?.editorConfig&&!m&&u&&p.current){const t=u.initializeCiq(p.current,{menuTitle:n?.editorConfig.transformFileMenuTitle,menuSubtitle:n?.editorConfig.transformFilePlaceholderText?n?.editorConfig.transformFilePlaceholderText:_,queryCharToUse:d,getLocalItems:e.getLocalItems,onItemSelected:async e=>{F.log(e),s&&s(e.suggestion),F.log("Item Selected"),n.postCIQItemSelectionHandler&&n.postCIQItemSelectionHandler(e.suggestion)},entitiesEnabled:n?.editorConfig.entitiesSupported,ExpanededECC:n?.editorConfig.isExpandedECCEnabled});C(t)}}),[u,m]);const w=(0,o.useRef)(k()),T=(0,o.useRef)(b()),[A,E]=(0,o.useState)(T.current.userInput);(0,o.useEffect)((()=>{t&&E((0,y.z)(T.current.userInput,w.current.userInput))}),[t]),(0,o.useEffect)((()=>{const e=p.current;r&&u&&e&&m&&(e.innerText=d,e.focus(),e.lastChild?window.getSelection().setPosition(e.lastChild,e.lastChild.textContent.length):e.firstChild&&window.getSelection().setPosition(e.firstChild,e.firstChild.textContent.length),u.forceInvokeCIQMenu(d))}),[p.current,r,u,m]);return o.createElement("span",{className:A,title:R,ref:p,contentEditable:!0,onInput:e=>{e.target.textContent===_?S(i):e.target.textContent.length>0&&R!==_&&S(_)},style:a})},x="Done! Your review has been started. Feel free to ask me for a status update at any time.",B="Check review status",H="Close this review",V="Edit review details",q="Confirm",W="Something went wrong while executing this request",G=new Map([[p.I.EntryPointCard,"ReviewAgentEntryPointCard"],[p.I.ConfirmInvitationCard,"ReviewAgentConfirmInvitationCard"],[p.I.ReviewStatusCard,"ReviewAgentReviewStatusCard"],[p.I.SuggestionCard,"ReviewAgentSuggestionsCard"]]),j=["Retrieving session information...","Checking for active reviews...","Setting up context..."],Z=["Processing your request...","Setting up due date & reminders....","Notifying your reviewers...."],J=["Updating reviewer counts...","Analyzing recent comments...","Compiling feedback..."],K=["Processing feedback...","Generating actionable suggestions...","Creating a prioritized list..."],Q=["Terminating active processes...","Clearing review data...","Finalizing review closure..."],X="https://microsoft.sharepoint-df.com/:w:/t/PPTOFastFoodTest/EX7Rw-e3ymlAmYUT6BVj12kBd9VTzVczouXYlEsewBGZsg?e=o2Fb5X",Y="Retry",$=864e5;var z;!function(e){e.LAUNCH_WITH_REVIEWERS="LAUNCH_WITH_REVIEWERS",e.LAUNCH_WITHOUT_REVIEWERS="LAUNCH_WITHOUT_REVIEWERS",e.LAUNCH_FROM_TOGGLE="LAUNCH_FROM_TOGGLE"}(z||(z={}));class ee{static generateId(){return ee.operationId++,"AugLoopChatAgent-Reviewer"+ee.operationId.toString()}}var te,ie,ne,se,ae;ee.operationId=0,function(e){e.Client="Client",e.Server="Server"}(te||(te={})),function(e){e.ErrorMessage="ErrorMessage",e.ErrorCode="ErrorCode",e.ErrorType="ErrorType",e.ErrorCategory="ErrorCategory"}(ie||(ie={})),function(e){e.ReviewerAgentPeoplePickerEditorConfigNotProvided="people-picker-editor-config-not-provided"}(ne||(ne={})),function(e){e.AgentCreated="Agent_Created",e.AgentClosed="Agent_Closed",e.AgentStatusChanged="Agent_Status_Changed",e.WorkflowRegisterd="Workflow_Registered",e.AddDetailsButtonClicked="Add_Details_Button_Clicked",e.StartReviewButtonClicked="Start_Review_Button_Clicked",e.SendResponseToClient="Send_Response_To_Client",e.ChatPaneLoaded="Chat_Pane_Loaded",e.DefaultSignalOperation="Default_Signal_Operation",e.SendRequestToAL="Send_Request_To_AL",e.SendInitialSignal="Send_Initial_Signal",e.SendCloseAgentSignal="Send_Close_Agent_Signal",e.SendUIStateSyncSignal="Send_UI_State_Sync_Signal",e.SendUIStateSyncSignalZeroReviewers="Send_UI_State_Sync_Signal_Zero_Reviewers",e.InvitationRenderCardRequest="Invitation_Render_Card_Request",e.ProcessSummaryCard="Process_Summary_Card"}(se||(se={})),function(e){e.AgentId="AgentId",e.AgentStatus="AgentStatus",e.AgentEventType="AgentEventType",e.AgentEventParameters="AgentEventParameters"}(ae||(ae={}));const oe="";var re,ge;!function(e){e.NONE="None",e.ONE_DAY_BEFORE="1 day before",e.THREE_DAYS_BEFORE="3 days before"}(re||(re={})),function(e){e.INIT="Init",e.COMPLETED="Completed",e.CRITICAL="Critical",e.ACTIVE="Active",e.INACTIVE="Inactive",e.FAILED="Failed",e.EXPIRED="Expired"}(ge||(ge={}));var de=i(43479),le=i(7573),ce=i(98483),ue=i(58651);const he=({displayName:e,mail:t})=>({query:"create agent",queryId:(0,ce.A)(),createAgent:{templateName:"ReviewSync",mode:R.Z.CREATE,propValues:JSON.stringify({AUTHOR:{displayName:e,mail:t}})}}),pe=e=>({query:"Show Suggestion",queryId:(0,ce.A)(),agentId:e,suggestionCardSignal:{agentId:e}}),me=e=>({query:"clean up agent",agentId:e,queryId:(0,ce.A)(),cleanupSignal:{agentId:e}}),Ce=(e,t)=>{let i={query:e,queryId:(0,ce.A)()};return t&&(i={...i,agentId:t}),i},Re=(e,t)=>{const i=JSON.stringify(e);return{query:"UI STATE SYNC",queryId:(0,ce.A)(),agentId:t,uiStateSync:{jsonPayload:i}}},Se=(e,t,i,n)=>({query:"suggestion applied",queryId:(0,ce.A)(),agentId:e,suggestionActionSignal:{agentId:e,commentId:t,changeType:i,isValid:n}}),ve=e=>{const t=JSON.parse(e);return t?t.mode:R.Z.NONE},fe=e=>{const t=JSON.parse(e)?.payload;return t?t.agentId:""},Ie=(e,t)=>{const i=JSON.parse(e)?.payload,n=i?.agentStatus??"";return""===n?t:n},ye=(e,t="Hello, welcome back. How can I help you today?")=>{let i;try{i=JSON.parse(e)?.payload}catch(t){ue.log("Error in parsing payload",t),ue.log("Response message",e)}return i?i.displayMessage:t},we=e=>{let t;try{t=JSON.parse(e)?.payload}catch(t){ue.log("Error in parsing payload",t),ue.log("Response message",e)}return ue.log("ReviewerAgent:: payload: ",t),t},Te=e=>void 0!==JSON.parse(e).uiType,Ae=e=>JSON.parse(e).uiType;function Ee(e){if(e instanceof Date)return e;const t="string"==typeof e?parseInt(e):e;return new Date(t)}function De(e){const t=e.trim(),i=Number(t);if(isNaN(i))return NaN;const n=parseInt(t,10);return i===n?n:NaN}function Pe(e={}){const t={};for(const i in e.props||{})t[i]=e.props[i]?.defaultValue;return t}const Le=(e,t=!1)=>{const i={};for(const n of e)if(n)switch(n.kind){case h.T.DATE_PICKER:{const e=Pe(n);if(t)e.selectedDate=Ee(e.selectedDate);else{const t=new Date;t.setDate(t.getDate()+7),0===t.getDay()?t.setDate(t.getDate()+1):6===t.getDay()&&t.setDate(t.getDate()+2),e.selectedDate=t}i[h.T.DATE_PICKER]=e}break;case h.T.TEXT_AREA:{const e=Pe(n);i[h.T.TEXT_AREA]=e}break;case h.T.PEOPLE_PICKER:{const e=Pe(n);i[h.T.PEOPLE_PICKER]=e}break;case h.T.DROP_DOWN:{const e=Pe(n);if(e.displayValue=re.NONE,t){if(e.selectedValue=e.selectedValue||re.NONE,e.selectedValue!==re.NONE)if(isNaN(De(e.selectedValue)))e.selectedValue=re.NONE,e.displayValue=re.NONE;else{const t=new Date(parseInt(e.selectedValue)).toDateString();e.displayValue=t}}else e.selectedValue=re.NONE;i[h.T.DROP_DOWN]=e}break;case h.T.SUBMIT:{const e=Pe(n);i[h.T.SUBMIT]=e}break;default:throw new Error(`Unsupported kind: ${n.kind}`)}return i};function Ne(e=Me){return{type:de.jA.Default,title:Y,text:Y,iconRegular:le.DXr,iconHover:le.fC9,handleButtonOnClick:e}}const Me=async(e,t,i)=>{Ue("Retry button clicked"),He.getInstance().removeActionButtonFromLastCard(),He.getInstance().showActionCard(Y),await He.getInstance().invokeReviewAgent()},Ue=(...e)=>{ue.log("ReviewerAgent::"+(new Date).toUTCString(),...e)},be=e=>{const t=[],i=new Date;for(const n in re){let s=new Date(e),a=0;switch(re[n]){case re.ONE_DAY_BEFORE:a=1;break;case re.THREE_DAYS_BEFORE:a=3;break;case re.NONE:t.push(re.NONE);break;default:continue}const o=s.getTime()-a*$;if(a>0&&o>=i.getTime()){s=new Date(o);const e=s.toLocaleDateString(),i=`${re[n]} (${e})`;t.push(i)}}return t};async function ke(e,t,i){Ue("ReviewerAgent:: suggestionCallback called"),await He.getInstance().onApplySuggestion(e,t,i),await He.getInstance().sendSuggestionActionSignal(e,i)}function _e(e){Ue("ReviewerAgent:: suggestion navigation clickedcalled"),He.getInstance().onSuggestionCardNavigation(e)}function Fe(e,t){if("None"!==e&&"None"!==t){return 0!==function(e,t){const i=Oe(e),n=Oe(t),s=(i-n)/$;return Math.floor(Math.abs(s))}(e,t)}return e!==t}function Oe(e){let t;if(!(e instanceof Date)){const i=Number(e);t=isNaN(i)?new Date(e):new Date(i)}const i=t.getTime();if(isNaN(i))throw new Error(`Provided date ${e} is invalid`);return i}function xe(e,t,i,n,s){e.sendTelemetryAgentEventData([{key:ae.AgentEventType,value:t},{key:ae.AgentEventParameters,value:i},{key:ae.AgentId,value:n},{key:ae.AgentStatus,value:s}])}var Be=i(58651);class He extends r.h{sendSuggestionSignal(){this.copilotChatRef.current?.addChatMessages([{messageType:g._.ChatCardWrapper,body:{user:"human",element:"Show Suggestions"}}]);const e={documentConfig:{documentURL:this.documentURL}},t={...pe(this.agentID),config:e};this.copilotChatRef.current?.submitOperation({operation:new d.g0({parentPath:["Signal",m.br.getTypeName()],items:[{id:ee.generateId(),body:new m.br(t)}]}),workflowAnnotationType:C.xj.getTypeName()}),this.copilotChatRef.current?.startLoadingUi()}constructor(e,t,i,s,a,r,d,c,u,m,C){super(),this.commentId="",this.documentURL=X,this.userQuery="",this.authorName="",this.authorMail="",this.message="",this.date=null,this.reminder="",this.agentID="",this.agentStatus=ge.INIT,this.isInitialCardShown=!1,this.isReturningUser=!1,this.firstMessageText="",this.annotationId=void 0,this.telemetryLoggerUtils=n.j.getInstance(),this.agentLaunchType=z.LAUNCH_WITH_REVIEWERS,this.processInvitationRenderCardRequest=e=>{Be.log("ReviewerAgent::  processInvitationRenderCardRequest response ",e);const t=we(e);Be.log("ReviewerAgent::  processInvitationRenderCardRequest payload ",t);const i=t?.props||t?.additionalPayload?.props||{},n=i?.headerText||t?.additionalPayload?.headerText;Be.log("ReviewerAgent::  processInvitationRenderCardRequest payload.props ",i);const s=function(e){let t=(0,ce.A)();return t=e?`EditReviewDetails-${t}`:`${G.get(p.I.ConfirmInvitationCard)}-${t}`,t}(this.isReturningUser);this.confirmInvitationCardProps={headerText:n,individualComponentPropsMap:Le(i,this.isReturningUser),messageId:s},this.isReturningUser?this.returningUserReviewDetailsProps=JSON.parse(JSON.stringify(this.confirmInvitationCardProps)):this.returningUserReviewDetailsProps=void 0;const a=this.confirmInvitationCardProps.individualComponentPropsMap[h.T.PEOPLE_PICKER],r=this.confirmInvitationCardProps.individualComponentPropsMap[h.T.TEXT_AREA],g=this.confirmInvitationCardProps.individualComponentPropsMap[h.T.DATE_PICKER],d=this.confirmInvitationCardProps.individualComponentPropsMap[h.T.DROP_DOWN],c=this.confirmInvitationCardProps.individualComponentPropsMap[h.T.SUBMIT];var u,m,C,R,S;this.reviewers=[],a&&(Array.isArray(a.suggestions)||(a.suggestions=a.suggestions?.value||[]),this.isReturningUser?(a.suggestions.forEach((e=>{e.isReadOnly=!0})),this.reviewers=a.suggestions):a.suggestions=this.reviewers,this.peoplePickerEditorConfig||(Be.error("ReviewerAgent::  processInvitationRenderCardRequest peoplePickerEditorConfig is not provided"),u=this.telemetryLoggerUtils,m="ReviewerAgent::  processInvitationRenderCardRequest peoplePickerEditorConfig is not provided",C=te.Server,R=ne.ReviewerAgentPeoplePickerEditorConfigNotProvided,S=l.S2.Error,u.sendTelemetryAgentErrorData([{key:ie.ErrorMessage,value:m},{key:ie.ErrorType,value:C},{key:ie.ErrorCode,value:R},{key:ie.ErrorCategory,value:S}])),a.inputComponent=((e,t,i)=>{let n;return i&&(n={editorConfig:i,alSession:e,handleInChatInput:!0}),o.createElement(O,{editorProps:n,placeholderText:"Type / to add reviewers",onItemSelected:t})})(this.session,this.onItemSelected,this.peoplePickerEditorConfig),a.onPeopleRemoved=e=>{this.reviewers=this.reviewers.filter((t=>t.mail!==e.mail)),a.suggestions=this.reviewers,this.isReturningUser&&c&&(c.isFormReadyForSubmission=this.validateBeforeSubmit()),this.copilotChatRef.current?.updateMessage(this.getConfirmInvitationCardResponseMessage())}),r&&(this.message=r.message,r.onMessageChange=e=>{Be.log("ReviewerAgent::  onMessageChange message ",e),this.message=e,(0===this.message.trim().length||this.message.trim().length>0&&c&&!c.isFormReadyForSubmission)&&(c.isFormReadyForSubmission=this.validateBeforeSubmit(),this.copilotChatRef.current?.updateMessage(this.getConfirmInvitationCardResponseMessage()))}),g&&(this.date=g.selectedDate.getTime(),g.onDateChange=e=>{Be.log("ReviewerAgent::  onDateChange date ",e),e.setHours(23,59,59,999),this.date=e.getTime(),this.reminder=re.NONE,d&&(d.selectedValue=this.reminder,d.displayValue=this.reminder,d.options=be(this.date)),c&&(c.isFormReadyForSubmission=this.validateBeforeSubmit()),this.copilotChatRef.current?.updateMessage(this.getConfirmInvitationCardResponseMessage())}),d&&(this.date&&(d.options=be(this.date)),this.reminder=d.selectedValue,d.onItemSelected=e=>{if(Be.log("ReviewerAgent::  onDateChange item ",e),e.includes("1 day")){const e=this.date-864e5;this.reminder=e.toString()}else if(e.includes("3 days")){const e=this.date-2592e5;this.reminder=e.toString()}else{const t=new Date(e);isNaN(t.getTime())?this.reminder=e:this.reminder=new Date(e).toString()}c&&(c.isFormReadyForSubmission=this.validateBeforeSubmit()),d.selectedValue=this.reminder,d.displayValue=e,this.copilotChatRef.current?.updateMessage(this.getConfirmInvitationCardResponseMessage())}),c&&(c.onSubmit=()=>this.sendUIStateSyncSignal()),Be.log("ReviewerAgent::  processInvitationRenderCardRequest this.confirmInvitationCardProps: ",this.confirmInvitationCardProps),this.isReturningUser||this.agentLaunchType!==z.LAUNCH_WITH_REVIEWERS||this.showInvitationCard(),xe(this.telemetryLoggerUtils,se.InvitationRenderCardRequest,oe,this.agentID??oe,this.agentStatus??oe)},this.showInvitationCard=()=>{this.confirmInvitationCardProps.individualComponentPropsMap[h.T.SUBMIT].isFormReadyForSubmission=this.validateBeforeSubmit(),this.copilotChatRef.current?.addResponseMessage(this.getConfirmInvitationCardResponseMessage())},this.getConfirmInvitationCardResponseMessage=()=>{const e=this.confirmInvitationCardProps.messageId||G.get(p.I.ConfirmInvitationCard);return{chatCardType:g._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:p.I.ConfirmInvitationCard,reviewAgentInternalCardProps:this.confirmInvitationCardProps}}},chatMessageBodyData:{messageId:e}}},this.onItemSelected=e=>{const t={displayName:e.text,mail:e.id};if(!this.reviewers.find((e=>e.mail===t.mail))){if(this.reviewers.push(t),this.confirmInvitationCardProps.individualComponentPropsMap[h.T.PEOPLE_PICKER].suggestions=this.reviewers,this.isReturningUser){const e=this.confirmInvitationCardProps?.individualComponentPropsMap?.[h.T.SUBMIT];e&&(e.isFormReadyForSubmission=this.validateBeforeSubmit())}this.copilotChatRef.current?.updateMessage(this.getConfirmInvitationCardResponseMessage())}},this.copilotChatRef=e,this.session=t,this.userQuery=i||"Start a review on this document",this.documentURL=s||X,this.authorName=a||"Aditya Aswal",this.authorMail=r||"aditysasaaswal@microsoft.com",this.setSuggestionList=d,this.isReviewerNotAddedButtonClicked=c||!1,this.agentLaunchType=u,this.getDocumentSensitivity=m,this.peoplePickerEditorConfig=C}setCallbacks(e,t,i,n){this.onApplySuggestion=e,this.toggleChangeHandler=t,this.addCommentToFirstLineOfDocument=i,this.onSuggestionCardNavigation=n}setFastModeReviewerAgentEnabled(e){this.isFastModeReviewerAgentEnabled=e}getAgentStatus(){return this.agentStatus}static getInstance(e,t,i,n,s,a,o,r,g,d,l){return He.instance||(He.instance=new He(e,t,i,n,s,a,o,r,g,d,l)),He.instance}static destroy(){Be.log("ReviewerAgent:: Destroying CopilotCommunicationHandlerImpl instance."),He.instance=void 0}getWorkflowsToRegister(){Be.log("ReviewerAgent:: getWorkflowsToRegister.");const e=[];return e.push({workflowAnnotationType:C.xj.getTypeName(),shouldHandleResponse:!1,augloopResponseTimerRequired:!0,augloopResponseTimeout:65e3}),Be.log("ReviewerAgent:: Registered workflows"),xe(this.telemetryLoggerUtils,se.WorkflowRegisterd,"ReviewerAgentWorkflowRegistered",this.agentID??oe,this.agentStatus??oe),e}handoffInitialCard(){this.isInitialCardShown||this.agentLaunchType==z.LAUNCH_FROM_TOGGLE||(this.showStartupCard(),this.isInitialCardShown=!0)}showStartupCard(){this.copilotChatRef.current?.addResponseMessage({chatCardType:g._.Default,chatMessageData:{defaultMessageProps:{user:"human",messageHeader:{text:"Start reviewersync"}}},stopLoadingUi:!0})}showAcknowledgementCard(){this.isReviewerNotAddedButtonClicked&&(this.firstMessageText=x),this.firstMessageText&&this.copilotChatRef.current?.addResponseMessage({chatCardType:g._.MarkdownCard,chatMessageData:{markDownCardProps:{message:this.firstMessageText}},stopLoadingUi:!0})}getPlainTextChatCardResponse(e,t="chat",i=!0){return{chatCardType:g._.Default,chatMessageData:{defaultMessageProps:{user:t,messageHeader:{text:e}}},stopLoadingUi:i}}async handleRetryButtonClickedForAgentFailure(e,t,i){this.sendUIStateSyncSignal(),this.removeActionButtonFromLastCard()}sendResponseToClient(e){Be.log("ReviewerAgent:: SendResponseToClient.",e),this.isReturningUser=!1;const t=e.id;if(!this.annotationId||this.annotationId!==t){if(this.annotationId&&this.annotationId===t||(this.annotationId=t),e.body.chatResponse?.status===v.lC.Success){this.handoffInitialCard();const t=e.body.chatResponse?.messages;if(t?.length>=2){this.agentLaunchType===z.LAUNCH_FROM_TOGGLE&&this.copilotChatRef.current?.addResponseMessage({chatCardType:g._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:p.I.EntryPointCard,reviewAgentInternalCardProps:{isTriggeredFromReviewerAgentPane:!0,onAddDetailsButtonClick:()=>{this.isReviewerNotAddedButtonClicked=!1,this.showAcknowledgementCard(),this.showInvitationCard(),Be.log("onAddDetailsButtonClick"),xe(this.telemetryLoggerUtils,se.AddDetailsButtonClicked,oe,this.agentID??oe,this.agentStatus??oe)},onStartReviewButtonClick:()=>{this.isReviewerNotAddedButtonClicked=!0,this.sendUIStateSyncSignalZeroReviewers(),this.copilotChatRef.current?.startLoadingUi(),Be.log("onStartReviewButtonClick"),xe(this.telemetryLoggerUtils,se.StartReviewButtonClicked,oe,this.agentID??oe,this.agentStatus??oe)}}}}}}),this.firstMessageText=this.isReviewerNotAddedButtonClicked?x:t[0]?.text,this.firstMessageText&&this.agentLaunchType!==z.LAUNCH_FROM_TOGGLE&&this.copilotChatRef.current?.addResponseMessage({chatCardType:g._.MarkdownCard,chatMessageData:{markDownCardProps:{message:this.firstMessageText}},stopLoadingUi:!0});const e=t[1]?.text;if(Be.log("ReviewerAgent:: SendResponseToClient secondMessage mode: ",ve(e)),(e=>{ue.log("ReviewerAgent::  responseMessageText.",e);try{return void 0!==we(e)}catch(e){return ue.log("ReviewerAgent::  responseMessageText parsing error: ",e),!1}})(e)&&ve(e)===R.Z.CREATE){Be.log("ReviewerAgent:: Create Agent responsePayLoad: ",e),this.agentID=fe(e);const t=Ie(e,this.agentStatus);this.agentStatus=t,this.agentLaunchType===z.LAUNCH_WITHOUT_REVIEWERS?this.sendUIStateSyncSignalZeroReviewers():this.processInvitationRenderCardRequest(e)}}else if(1===t?.length&&ve(t[0]?.text)===R.Z.RETURNINGUSER){this.isReturningUser=!0;const e=t[0]?.text;this.agentID=fe(e);const i=Ie(e,this.agentStatus);if(this.agentStatus=i,Te(e)&&Ae(e)===S.aq.SUMMARYCARD)Be.log("ReviewerAgent:: Returning user with responsePayLoad: ",e),this.processSummaryCard(e);else if(Te(e)&&Ae(e)===S.aq.SUGGESTIONCARD)Be.log("ReviewerAgent:: Returning user with responsePayLoad: ",e),this.processSuggestionCard(e);else{new Set([ge.INIT,ge.COMPLETED,ge.FAILED,ge.EXPIRED]).has(i)?this.setSuggestionList([]):this.setSuggestionList([V,B,H]);const e=t[0]?.text;this.agentID=fe(e),this.commentId=(e=>{try{const t=JSON.parse(e)?.payload?.additionalPayload;return t?t.agentCommentId:""}catch(e){return ue.log("Error in parsing agentCommentId",e),""}})(e),this.processInvitationRenderCardRequest(e);const n=Ie(e,this.agentStatus);this.agentStatus=n,Be.log("ReviewerAgent:: Returning user with responsePayLoad,show suggestion pills ");const s=this.getPlainTextChatCardResponse(ye(e));this.copilotChatRef.current?.addResponseMessage(s)}}}else if(e.body.chatResponse?.status===v.lC.ErrorInExecution){const t=e.body.chatResponse?.messages?.[0]?.text||"{}",i=we(t),n=this.getPlainTextChatCardResponse(ye(t,W));if(i?.agentStatus===ge.INIT&&this.confirmInvitationCardProps&&this.confirmInvitationCardProps.isCardSubmitted){const e={...n,chatMessageBodyData:{actionButtonList:[Ne(this.handleRetryButtonClickedForAgentFailure.bind(this))]}};this.copilotChatRef.current?.addResponseMessage(e),this.setSuggestionList([])}else{this.copilotChatRef.current?.addResponseMessage(n);const e=n.chatMessageData.defaultMessageProps.messageHeader.text;e.includes("Only the document creator")&&e.includes("can initiate the review process.")?this.setSuggestionList([]):this.setSuggestionList([V,B,H])}}else{const t=e.body.chatResponse?.messages?.[0]?.text,i=this.getPlainTextChatCardResponse(ye(t,W));this.copilotChatRef.current?.addResponseMessage(i),this.setSuggestionList([V,B,H])}xe(this.telemetryLoggerUtils,se.SendResponseToClient,1==this.isReturningUser?"ReturningUser":"NewUser",this.agentID??oe,this.agentStatus??oe)}}processSuggestionCard(e){const t=((e,t,i,n)=>(ue.log("ReviewerAgent:: data: ",e),{suggestionIndices:(e?.props?.[0]?.props?.suggestionIndices||[]).map((e=>({onSuggestionCardNavigation:i,onApplySuggestion:t,initialText:e.initialText,suggestedText:e.suggestedText,commentId:e.commentId,changeType:e.changeType,appName:n})))}))(we(e),ke,_e,this.peoplePickerEditorConfig?.settings?.hostAppName?.toLowerCase()||"");this.copilotChatRef.current?.addResponseMessage({chatCardType:g._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:p.I.SuggestionCard,reviewAgentInternalCardProps:t}}},chatMessageBodyData:{messageId:G.get(p.I.SuggestionCard)},stopLoadingUi:!0}),this.setSuggestionList([V,B,H])}processSummaryCard(e){const t=we(e),i=t.props.map((e=>{let t={reviewersWithAction:[],statusMessage:"",labelForReviewedPeople:"",labelForPendingPeople:"",commentsSummaryHeader:"",commentsSummaries:[]};return t=e.props,t}));const n=t?.props?.[0]?.props.areSuggestionsGenerated;this.copilotChatRef.current?.addResponseMessage({chatCardType:g._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:p.I.ReviewStatusCard,reviewAgentInternalCardProps:i[0]}}},chatMessageBodyData:{messageId:G.get(p.I.ReviewStatusCard)},stopLoadingUi:!0}),n?this.setSuggestionList([V,"Show suggestions",B,H]):this.setSuggestionList([V,B,H]),Be.log("ReviewerAgent:: processSummaryCard payload: ",t),xe(this.telemetryLoggerUtils,se.ProcessSummaryCard,oe,this.agentID??oe,this.agentStatus??oe)}async sendEventToClient(e,t){Be.log("ReviewerAgent:: SendEventToClient.",e),e==c.PV.CopilotChatLoaded&&(this.invokeReviewAgent(),xe(this.telemetryLoggerUtils,se.ChatPaneLoaded,"SendEventToClient",this.agentID??oe,this.agentStatus??oe))}async invokeReviewAgent(){var e;(e=this.getDocumentSensitivity?await this.getDocumentSensitivity():void 0)&&e.parent&&(ue.log("ReviewerAgent:: sensitivity: ",e),1)?this.copilotChatRef.current?.addResponseMessage({chatCardType:g._.Default,chatMessageData:{defaultMessageProps:{user:"chat",messageHeader:{text:"I'm sorry, but I can't assist you in initiating a review as this document is marked confidential. Please take a moment to review the sensitivity label and try again."}}},chatMessageBodyData:{actionButtonList:[Ne()]},stopLoadingUi:!0}):(Be.log("ReviewerAgent:: Sending initial signal"),this.sendInitialSignal())}getDefaultSignalOperation(e,t,i,n,s){let a;Be.log("ReviewerAgent:: getDefaultSignalOperation.",e,t),xe(this.telemetryLoggerUtils,se.DefaultSignalOperation,e,this.agentID??oe,this.agentStatus??oe);const o={documentConfig:{documentURL:this.documentURL}};var r;e.toLowerCase().includes("status")?(a={...(r=this.agentID,{query:"status review of agent",queryId:(0,ce.A)(),agentId:r,summaryCardSignal:{agentId:r}}),config:o},this.copilotChatRef.current?.updateLoadingComponentProps({loadingUiStringList:J})):e.toLowerCase().includes("close")?a={...me(this.agentID),config:o}:e.toLowerCase().includes("suggestion")?(a={...pe(this.agentID),config:o},this.copilotChatRef.current?.updateLoadingComponentProps({loadingUiStringList:K})):e.toLowerCase().includes("start")?(a={...he({mail:this.authorMail,displayName:this.authorName}),config:o},this.copilotChatRef.current?.updateLoadingComponentProps({loadingUiStringList:j})):a={...Ce(e,this.agentID)};const g={operation:new d.g0({parentPath:["Signal",m.br.getTypeName()],items:[{id:ee.generateId(),body:new m.br(a)}]}),workflowAnnotationType:C.xj.getTypeName()};return Promise.resolve(g)}getHostSettings(){return{appName:"Testing",appPlatform:"All",devBuild:!0,environment:c.DF.DEV,sessionId:"",augloopUrl:"http://localhost:20080"}}getAuthToken(){return Be.log("ReviewerAgent:: getauthtoken"),Promise.resolve("")}shouldSendRequestToAugloop(e){if(e.toLowerCase().includes(H.toLowerCase())){const t=new Set([ge.ACTIVE,ge.CRITICAL,ge.INACTIVE]);return xe(this.telemetryLoggerUtils,se.SendRequestToAL,e,this.agentID??oe,this.agentStatus??oe),t.has(this.agentStatus)?(this.copilotChatRef.current?.addResponseMessage({chatCardType:g._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:p.I.EntryPointCard,reviewAgentInternalCardProps:{isTriggeredFromReviewerAgentPane:!0,isSecondHeaderHidden:!0,isIconHidden:!0,buttonLeftText:q,buttonRightText:"Cancel",reviewAgentDescriptionText:"Closing the review will end access to suggestions and summaries generated for this session. This action cannot be undone.",onAddDetailsButtonClick:()=>{Be.log("Cancel button clicked for close agent reviewer"),this.setSuggestionList([V,B,H])},onStartReviewButtonClick:()=>{this.copilotChatRef.current?.addResponseMessage({chatCardType:g._.Default,chatMessageData:{defaultMessageProps:{user:"human",messageHeader:{text:q}}},stopLoadingUi:!0}),this.copilotChatRef.current?.startLoadingUi(),this.sendCloseAgentSignal(),this.setSuggestionList([])}}}}}}),this.setSuggestionList([V,B])):(this.copilotChatRef.current?.addResponseMessage(this.getPlainTextChatCardResponse("Unable to close review at this moment.")),this.setSuggestionList([V,B])),Promise.resolve(!1)}if(e.toLowerCase().includes(V.toLowerCase())){if(new Set([ge.ACTIVE,ge.INACTIVE,ge.CRITICAL]).has(this.agentStatus)){const e=this.confirmInvitationCardProps?.individualComponentPropsMap?.[h.T.SUBMIT];e&&(e.isFormReadyForSubmission=this.validateBeforeSubmit()),this.copilotChatRef.current?.addResponseMessage(this.getConfirmInvitationCardResponseMessage()),this.setSuggestionList([B,H])}else this.copilotChatRef.current?.addResponseMessage(this.getPlainTextChatCardResponse("Unable to edit review details at this moment.")),this.setSuggestionList([B,H]);return Promise.resolve(!1)}return Promise.resolve(!0)}async getALSession(){if(Be.log("getALSession"),this.session)return this.session;throw new Error("Session is not undefined")}sendInitialSignal(){Be.log("sendInitialSignal"),xe(this.telemetryLoggerUtils,se.SendInitialSignal,oe,this.agentID??oe,this.agentStatus??oe);const e={documentConfig:{documentURL:this.documentURL}},t={...he({mail:this.authorMail,displayName:this.authorName}),config:e};this.copilotChatRef.current?.submitOperation({operation:new d.g0({parentPath:["Signal",m.br.getTypeName()],items:[{id:ee.generateId(),body:new m.br(t)}]}),workflowAnnotationType:C.xj.getTypeName()}),this.copilotChatRef.current?.startLoadingUi(),this.copilotChatRef.current?.updateLoadingComponentProps({loadingUiStringList:j})}async sendCloseAgentSignal(){Be.log("sendCloseAgentSignal"),xe(this.telemetryLoggerUtils,se.SendCloseAgentSignal,oe,this.agentID??oe,this.agentStatus??oe);const e={documentConfig:{documentURL:this.documentURL}},t={...me(this.agentID),config:e};this.copilotChatRef.current?.submitOperation({operation:new d.g0({parentPath:["Signal",m.br.getTypeName()],items:[{id:ee.generateId(),body:new m.br(t)}]}),workflowAnnotationType:C.xj.getTypeName()}),this.copilotChatRef.current?.updateLoadingComponentProps({loadingUiStringList:Q})}getUpdatedReviewDetailsData(){let e={};const t=this.returningUserReviewDetailsProps?.individualComponentPropsMap?.[h.T.DATE_PICKER];"string"==typeof t?.selectedDate&&(t.selectedDate=new Date(t.selectedDate));const i=t?.selectedDate?.getTime();this.date!==i&&(e={...e,DUE_DATE:this.date});const n=this.returningUserReviewDetailsProps?.individualComponentPropsMap?.[h.T.DROP_DOWN]?.selectedValue||re.NONE;Fe(this.reminder,n)&&(e={...e,REMINDER_CADENCE:this.reminder});const s=this.returningUserReviewDetailsProps?.individualComponentPropsMap?.[h.T.PEOPLE_PICKER]?.suggestions||[],a=this.reviewers.filter((e=>!s.some((t=>e.mail===t.mail))));return a.length&&(e={...e,REVIEWERS:a.map((e=>({...e,commentId:this.commentId,context:this.message})))}),e}getUIStateSyncData(){if(this.isReturningUser){return this.getUpdatedReviewDetailsData()}return{INVITE_EMAIL:this.message,DUE_DATE:this.date,FAST_MODE_ENABLED:this.isFastModeReviewerAgentEnabled,REMINDER_CADENCE:this.reminder,REVIEWERS:this.reviewers.map((e=>({...e,commentId:this.commentId,context:this.message}))),AUTHOR:{displayName:this.authorName,mail:this.authorMail}}}async sendUIStateSyncSignal(){this.reviewers.length>0&&await this.notifyClientOnReviewInitiation(),this.confirmInvitationCardProps.isCardSubmitted=!0,this.confirmInvitationCardProps.individualComponentPropsMap[h.T.SUBMIT].isFormReadyForSubmission=!1,this.copilotChatRef.current?.updateMessage(this.getConfirmInvitationCardResponseMessage()),Be.log("sendUIStateSyncSignal"),xe(this.telemetryLoggerUtils,se.SendUIStateSyncSignal,oe,this.agentID??oe,this.agentStatus??oe);const e=this.getUIStateSyncData(),t={documentConfig:{documentURL:this.documentURL}},i={...Re(e,this.agentID),config:t};this.copilotChatRef.current?.startLoadingUi(),this.copilotChatRef.current?.submitOperation({operation:new d.g0({parentPath:["Signal",m.br.getTypeName()],items:[{id:ee.generateId(),body:new m.br(i)}]}),workflowAnnotationType:C.xj.getTypeName()}),this.copilotChatRef.current?.updateLoadingComponentProps({loadingUiStringList:Z}),this.setSuggestionList([B,H])}validateBeforeSubmit(){if(this.isReturningUser){const e=this.getUpdatedReviewDetailsData(),t=e.DUE_DATE&&e.DUE_DATE>Date.now(),i=e.REVIEWERS&&e.REVIEWERS.length;return!(!t&&!i)}return this.message.length>0&&this.date>Date.now()}async sendUIStateSyncSignalZeroReviewers(){Be.log("sendUIStateSyncSignalZeroReviewers"),xe(this.telemetryLoggerUtils,se.SendUIStateSyncSignalZeroReviewers,oe,this.agentID??oe,this.agentStatus??oe);const e=new Date;e.setDate(e.getDate()+7);const t={INVITE_EMAIL:"",DUE_DATE:e.getTime(),REMINDER_CADENCE:"1 day before",REVIEWERS:[],AUTHOR:{displayName:this.authorName,mail:this.authorMail}},i={documentConfig:{documentURL:this.documentURL}},n={...Re(t,this.agentID),config:i};Be.log("sendUIStateSyncSignalZeroReviewers textTile",n),this.copilotChatRef.current?.submitOperation({operation:new d.g0({parentPath:["Signal",m.br.getTypeName()],items:[{id:ee.generateId(),body:new m.br(n)}]}),workflowAnnotationType:C.xj.getTypeName()}),this.setSuggestionList([B,H])}async notifyClientOnReviewInitiation(){const e=`[via Reviewer]\n\nHello ${this.reviewers.map((e=>e.displayName)).join(", ")}\n\nHere's how you can help with this document review:\n"${this.message}"`;Be.log(e),this.commentId=await this.addCommentToFirstLineOfDocument(e??"Please review this document",this.commentId)}showActionCard(e){this.copilotChatRef.current.addResponseMessage({chatCardType:g._.Default,chatMessageData:{defaultMessageProps:{user:u.Q9.Human,messageHeader:{text:e}}}})}removeActionButtonFromLastCard(){this.copilotChatRef.current.updateLastMessage({chatCardType:g._.Default,chatMessageBodyData:{actionButtonList:[]},addCardToChatHistory:!1})}sendSuggestionActionSignal(e,t){Ue("sendSuggestionActionSignal");const i={documentConfig:{documentURL:this.documentURL}},n={...Se(this.agentID,e,t,!1),config:i};this.copilotChatRef.current?.submitOperation({operation:new d.g0({parentPath:["Signal",m.br.getTypeName()],items:[{id:ee.generateId(),body:new m.br(n)}]}),workflowAnnotationType:C.xj.getTypeName()})}}var Ve=i(58651);const qe=(e,t)=>{Ve.log("onAgentToggleChangeStub")},We=(e,t,i)=>{Ve.log("onApplySuggestionStub: ",e,t,i)},Ge=e=>{Ve.log("onSuggestionCardNavigationStub: ",e)},je=e=>(Ve.log("addCommentToFirstLineOfDocument: ",e),Promise.resolve("Comment added successfully")),Ze={themePrimary:"#598FEC",themeSecondary:"#8763c2",themeLight:"#0E336A",themeDark:"#464FEB",themeTertiary:"#598FEC",themeDarker:"#353696",themeMedium:"#464FEB",themeDarkAlt:"#3D91FF",themeLighterAlt:"#6CEBE2",themeLighter:"#9270FF",neutralPrimary:"#FFFFFF",neutralLight:"#292929",neutralLighter:"#757575",neutralLighterAlt:"#666666",neutralSecondaryAlt:"#FFFFFF",neutralTertiary:"#3D3D3D",neutralTertiaryAlt:"#3D3D3D",neutralQuaternaryAlt:"#FFFFFF",neutralDark:"#2461CA",black:"#FFFFFF",white:"#000000"},Je={themePrimary:"#185abd",themeSecondary:"#8763c2",themeLight:"#D2E0F4",themeDark:"#82ABF1",themeTertiary:"#598FEC",themeDarker:"#598FEC",themeMedium:"#82ABF1",themeDarkAlt:"#3D91FF",themeLighterAlt:"#6CEBE2",themeLighter:"#9270FF",neutralLighter:"#f5f5f5",neutralDark:"#1651AA",white:"#FFFFFF"};var Ke=i(88539);const Qe=(0,E.n)((0,Ke.f)({chatFreStack:{height:"calc(100vh - 50px)"},chatUiStack:{top:"20px"}}));var Xe=i(58651);const Ye=({isTestApp:e=!1,copilotTelemetryHandler:t,alSession:r,documentURL:g,userQuery:d,onReviewerAgentToggleChange:l,onApplySuggestion:c,addCommentToFirstLineOfDocument:u,onSuggestionCardNavigation:h,peoplePickerEditorConfig:p,isDarkModeEnabled:m=!1,isHighContrastModeEnabled:C=!1,authorName:R,authorEmail:S,isReviewerNotAddedButtonClicked:v=!1,agentLaunchType:f=z.LAUNCH_WITH_REVIEWERS,getDocumentSensitivity:I,isReviewerToggleEnabled:y=!1})=>{Xe.log("ReviewerAgent: ",r,"IsTestApp: ",e);const w=o.useRef(null),[T,A]=(0,o.useState)([]);(0,o.useEffect)((()=>{}),[T]);const E=async(e,t,i)=>{Xe.log("ReviewerAgent:: onApplySuggestionsCbk: ",e,t,i),c&&await c(e,t,i)},D=async e=>{Xe.log("ReviewerAgent:: onSuggestionCardNavigationStubCbk: ",e);const t=parseInt(e,16);await h(t.toString())};e&&(d="create agent",g="https://www.microsoft.com",R="Aditya Test",S="test@msft.com");const P=He.getInstance(w,e?void 0:r,d,g,R,S,A,v,f,I,p);e?P.setCallbacks(We,qe,je,Ge):P.setCallbacks(E,l,u,D);const L={settings:{hostAppId:"Word_Online",hostAppName:"Word",hostAppPlatform:"Web",hostAppScenario:"Copilot",hostDefaultLocale:"en-US",isDogfoodEnvironment:!0,resultTime:1e4},telemLogger:{logError:e=>{Xe.log("Shared Copilot CIQ Error Log: ",e)}},entitiesSupported:[],isExpandedECCEnabled:!1},N={headerText:"Reviewer",descriptionText:"I'm the ultimate partner for document reviews, and can help you launch, track progress and resolve review comments.",freImagePath:i(99948),hideGetStartedButton:!0},[M,U]=o.useState(!1),b={trySydneyToggleChecked:!1,trySydneyToggleEnabled:!1,tryWebSearchToggleEnabled:!1,trySydneyToggleOnChange:(e,t)=>{Xe.log("officeaicopilot-test-app: onChange for Try Sydney Toggle")},tryEnterpriseSearchToggleChecked:!1,tryEnterpriseSearchToggleEnabled:!1,tryEnterpriseSearchToggleOnChange:(e,t)=>{Xe.log("officeaicopilot-test-app: onChange for Enterprise Search Toggle")},tryReviewerAgentToggleChecked:!0,tryReviewerAgentToggleEnabled:y,tryReviewerAgentToggleOnChange:l,FastModeReviewerAgentToggleChecked:M,FastModeReviewerAgentToggleEnabled:P.getAgentStatus()===ge.INIT,FastModeReviewerAgentToggleOnChange:(e,t)=>{const i=!M;P.setFastModeReviewerAgentEnabled(i),U(i)}},k=Qe(),_=((e,t)=>({isDarkModeEnabled:e,isHighContrastModeEnabled:t,...e?Ze:Je}))(m,C);return(0,o.useEffect)((()=>(n.j.setTelemetryHandler(t),()=>{He.destroy()})),[]),o.createElement(a.B,{className:"ms-welcome",style:{display:"flex",gap:"8px",margin:"0px 4px"}},e||r?o.createElement(s.zn,{style:k,chatUiProps:{chatInputV2Props:{pluginsInfo:[],chatPlaceholderMessage:"Type a message for Reviewer",editorConfig:L},changeTopicUiProps:{hideChangeTopicButton:!0},freUiProps:N,toggleUiProps:b,suggestionPillsUiProps:{suggestionList:T}},copilotCommunicationHandler:P,useALRuntime:!!e,copilotTelemetryHandler:t,ref:w,theme:_}):o.createElement("div",null,"ReviewerAgent: alSession is required for non test"))};Ye.displayName="Reviewer"},99948:(e,t,i)=>{e.exports=i.p+"assets/fre-reviewer-agent-illustration.svg"}}]);
//# sourceMappingURL=vendors~ReviewerAgent.js.map